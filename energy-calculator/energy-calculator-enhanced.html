<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Energy Calculator - Working Version</title>
            <style>
            /* Energy Calculator Theme */
            :root {
                --primary-blue: #1976D2;
                --secondary-blue: #42A5F5;
                --accent-blue: #90CAF9;
                --light-blue: #E3F2FD;
                --dark-blue: #0D47A1;
                --success-green: #4CAF50;
                --warning-orange: #FF9800;
                --white: #FFFFFF;
                --gray: #757575;
                --light-gray: #F5F5F5;
                --border: #E0E0E0;
                --shadow: 0 2px 10px rgba(0,0,0,0.1);
            }

            * {
                margin: 0;
                padding: 0;
                box-sizing: border-box;
            }

            body {
                font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
                line-height: 1.6;
                color: #333;
                background-color: var(--light-blue);
            }

            .container {
                max-width: 1400px;
                margin: 0 auto;
                padding: 20px;
            }

            .header {
                text-align: center;
                margin-bottom: 40px;
                padding: 30px;
                background: linear-gradient(135deg, var(--primary-blue), var(--secondary-blue));
                color: var(--white);
                border-radius: 15px;
                box-shadow: var(--shadow);
            }

            .header h1 {
                font-size: 2.5rem;
                margin-bottom: 10px;
                font-weight: 300;
            }

            .header p {
                font-size: 1.1rem;
                opacity: 0.9;
            }

            /* API Status Panel */
            .api-status {
                background: var(--white);
                padding: 20px;
                border-radius: 15px;
                box-shadow: var(--shadow);
                margin-bottom: 30px;
            }

            .api-status h3 {
                color: var(--primary-blue);
                margin-bottom: 15px;
            }

            /* Category Selection Styles */
            .category-section {
                background: var(--white);
                padding: 30px;
                border-radius: 15px;
                box-shadow: var(--shadow);
                margin-bottom: 30px;
            }

            .category-section h2 {
                color: var(--primary-blue);
                margin-bottom: 10px;
                text-align: center;
            }

            .category-section p {
                text-align: center;
                color: var(--gray);
                margin-bottom: 20px;
            }

            .status-bar {
                background: var(--light-gray);
                padding: 15px;
                border-radius: 10px;
                margin-bottom: 20px;
                display: flex;
                justify-content: space-between;
                align-items: center;
                flex-wrap: wrap;
                gap: 10px;
            }

            .category-grid {
                display: grid;
                grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
                gap: 20px;
                margin-bottom: 20px;
            }

            .category-option {
                background: var(--white);
                border: 2px solid var(--border);
                border-radius: 15px;
                padding: 20px;
                text-align: center;
                cursor: pointer;
                transition: all 0.3s ease;
                box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
            }

            .category-option:hover {
                transform: translateY(-5px);
                box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
                border-color: var(--primary-blue);
            }

            .category-option.selected {
                border-color: var(--success-green);
                background: linear-gradient(135deg, #d4edda 0%, #c3e6cb 100%);
                box-shadow: 0 8px 25px rgba(40, 167, 69, 0.3);
            }

            /* Subcategory specific styling - different visual approach */
            #subcategory-grid .category-option {
                border: 2px solid var(--secondary-blue);
                background: var(--light-blue);
                position: relative;
            }

            #subcategory-grid .category-option:hover {
                border-color: var(--primary-blue);
                background: var(--accent-blue);
            }

            #subcategory-grid .category-option.selected {
                border-color: var(--primary-blue);
                background: var(--primary-blue);
                color: var(--white);
                transform: scale(1.05);
                box-shadow: 0 8px 25px rgba(25, 118, 210, 0.4);
            }

            #subcategory-grid .category-option.selected h4,
            #subcategory-grid .category-option.selected p {
                color: var(--white);
            }

            /* Add a checkmark indicator for selected subcategories */
            #subcategory-grid .category-option.selected::after {
                content: 'âœ“';
                position: absolute;
                top: 10px;
                right: 15px;
                background: var(--success-green);
                color: var(--white);
                width: 24px;
                height: 24px;
                border-radius: 50%;
                display: flex;
                align-items: center;
                justify-content: center;
                font-weight: bold;
                font-size: 14px;
            }

            .category-option h4 {
                color: var(--primary-blue);
                margin-bottom: 8px;
                font-size: 1.1rem;
            }

            .category-option p {
                color: var(--gray);
                font-size: 0.9rem;
            }

            /* Calculator Grid */
            .calculator-grid {
                display: grid;
                grid-template-columns: 1fr 1fr;
                gap: 30px;
                margin-bottom: 40px;
            }

            .calculator-section {
                background: var(--white);
                padding: 30px;
                border-radius: 15px;
                box-shadow: var(--shadow);
            }

            .section-title {
                color: var(--primary-blue);
                margin-bottom: 20px;
                font-size: 1.5rem;
                text-align: center;
                border-bottom: 2px solid var(--light-blue);
                padding-bottom: 10px;
            }

            .form-group {
                margin-bottom: 20px;
            }

            .form-group label {
                display: block;
                margin-bottom: 8px;
                color: var(--gray);
                font-weight: 500;
            }

            .form-group select {
                width: 100%;
                padding: 12px;
                border: 2px solid var(--border);
                border-radius: 8px;
                font-size: 1rem;
                background: var(--white);
                transition: border-color 0.3s ease;
            }

            .form-group select:focus {
                outline: none;
                border-color: var(--primary-blue);
            }
            
            .form-group input[type="number"] {
                width: 100%;
                padding: 12px;
                border: 2px solid var(--border);
                border-radius: 8px;
                font-size: 1rem;
                background: var(--white);
                transition: border-color 0.3s ease;
            }
            
            .form-group input[type="number"]:focus {
                outline: none;
                border-color: var(--primary-blue);
            }
            
            .product-selection-row {
                display: flex;
                align-items: center;
                gap: 15px;
            }
            
            .power-badge {
                background: var(--light-blue);
                color: var(--primary-blue);
                padding: 8px 12px;
                border-radius: 20px;
                font-weight: bold;
                font-size: 0.9rem;
                min-width: 60px;
                text-align: center;
                border: 2px solid var(--accent-blue);
                flex-shrink: 0;
            }
            
            .product-selection-row select {
                flex: 1;
            }

            /* Calculate Button */
            .calculate-section {
                text-align: center;
                margin-bottom: 40px;
            }

            .calculate-btn {
                background: linear-gradient(135deg, var(--success-green), #45a049);
                color: var(--white);
                border: none;
                padding: 15px 40px;
                font-size: 1.2rem;
                border-radius: 25px;
                cursor: pointer;
                transition: all 0.3s ease;
                box-shadow: var(--shadow);
            }

            .calculate-btn:hover {
                transform: translateY(-2px);
                box-shadow: 0 8px 25px rgba(76, 175, 80, 0.3);
            }

            /* Results Section */
            .results-section {
                background: var(--white);
                padding: 30px;
                border-radius: 15px;
                box-shadow: var(--shadow);
            }

            .results-grid {
                display: grid;
                grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
                gap: 20px;
                margin-bottom: 30px;
            }

            .results-panel {
                background: var(--white);
                padding: 20px;
                border-radius: 10px;
                box-shadow: var(--shadow);
            }

            .current-panel {
                border-left: 4px solid var(--primary-blue);
            }

            .efficient-panel {
                border-left: 4px solid var(--success-green);
            }

            .savings-panel {
                border-left: 4px solid var(--success-green);
            }

            .results-panel h3 {
                color: var(--primary-blue);
                margin-bottom: 15px;
                text-align: left;
            }

            .product-item {
                display: flex;
                justify-content: space-between;
                align-items: center;
                padding: 10px 0;
                border-bottom: 1px solid var(--light-gray);
            }

            .product-name {
                font-weight: 500;
                color: var(--gray);
            }

            .product-cost {
                font-weight: bold;
                color: var(--primary-blue);
            }

            .savings-banner {
                background: linear-gradient(135deg, var(--success-green), #45a049);
                color: var(--white);
                padding: 20px;
                border-radius: 10px;
                text-align: center;
                font-size: 1.2rem;
                font-weight: bold;
                margin-top: 20px;
            }

            .savings-banner::before {
                content: 'ðŸ’°';
                margin-right: 10px;
                font-size: 1.5rem;
            }

            /* Responsive Design */
            @media (max-width: 768px) {
                .calculator-grid {
                    grid-template-columns: 1fr;
                }
                
                .category-grid {
                    grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
                }
                
                .status-bar {
                    flex-direction: column;
                    text-align: center;
                }
            }
        </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>Energy Savings Calculator</h1>
            <p>Compare products and calculate your potential energy savings</p>
        </div>
        
        <!-- API Status Panel -->
        <div class="api-status">
            <h3>API Connection Status</h3>
            <div id="api-status-content">
                <p>Loading...</p>
            </div>
        </div>
        
        <!-- Category Selection -->
        <div class="category-section">
            <h2>Select Appliance Category</h2>
            <p>Choose a category to filter products and make selection easier</p>
            
            <div class="status-bar">
                <span id="current-selection">Current Category: All Categories | Subcategory: All Subcategories</span>
                <span id="product-count">Products Available: 0 of 0 total products</span>
            </div>
            
            <div class="category-grid" id="category-grid">
                <!-- Categories will be populated here -->
            </div>
        </div>
        
        <!-- Subcategory Selection -->
        <div class="category-section">
            <h2>Select Subcategory</h2>
            <div class="category-grid" id="subcategory-grid">
                <!-- Subcategories will be populated here -->
            </div>
        </div>
        
        <!-- Calculator Section -->
        <div class="calculator-grid">
            <div class="calculator-section">
                <h3 class="section-title">Current Product</h3>
                <div class="form-group">
                    <label for="electricity-rate">Electricity Rate (â‚¬ per kWh):</label>
                    <input type="number" id="electricity-rate" value="0.15" step="0.01" min="0" required>
                </div>
                <div class="form-group">
                    <label for="hours-use">Hours of Use per Day:</label>
                    <input type="number" id="hours-use" value="8" step="0.5" min="0" max="24" required>
                </div>
                <div class="form-group">
                    <label for="current-product">Select Current Product:</label>
                    <div class="product-selection-row">
                        <span class="power-badge" id="current-power-badge">0W</span>
                        <select id="current-product" required>
                            <option value="">Choose a product...</option>
                        </select>
                    </div>
                </div>
            </div>
            
            <div class="calculator-section">
                <h3 class="section-title">Energy-Efficient Alternative</h3>
                <div class="form-group">
                    <label for="efficient-hours-use">Hours of Use per Day:</label>
                    <input type="number" id="efficient-hours-use" value="8" step="0.5" min="0" max="24" required>
                </div>
                <div class="form-group">
                    <label for="efficient-product">Select Efficient Product:</label>
                    <div class="product-selection-row">
                        <span class="power-badge" id="efficient-power-badge">0W</span>
                        <select id="efficient-product" required>
                            <option value="">Choose a product...</option>
                        </select>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Calculate Button -->
        <div class="calculate-section">
            <button id="calculate-btn" class="calculate-btn">Calculate Energy Savings</button>
        </div>
        
        <!-- Results Section -->
        <div id="results-section" class="results-section" style="display: none;">
            <!-- Results will be displayed here -->
        </div>
    </div>
    
    <script>
        // Global variables
        let allProducts = [];
        let selectedCategory = 'all';
        let selectedSubcategory = 'all';
        const BACKEND_URL = 'http://localhost:4000';
        
        // Initialize when page loads
        document.addEventListener('DOMContentLoaded', function() {
            console.log('ðŸš€ Initializing Energy Calculator...');
            try {
                initializeCalculator();
            } catch (error) {
                console.error('âŒ Error during initialization:', error);
                // Fallback: try to load just sample data
                try {
                    console.log('ðŸ”„ Trying fallback sample data loading...');
                    loadEnhancedSampleData();
                } catch (fallbackError) {
                    console.error('âŒ Fallback also failed:', fallbackError);
                }
            }
        });
        
        // Initialize calculator
        function initializeCalculator() {
            // Load all product sources
            loadEnhancedSampleData();
            loadBackendProducts();
            loadRealProducts();
            loadEnergyStarProducts();
            setupEventListeners();
        }
        
        // Load products from local database
        function loadProductsFromDatabase() {
            console.log('ðŸ”„ Loading products from local database...');
            
            // Import the product database
            const script = document.createElement('script');
            script.src = 'product-database.js';
            script.onload = function() {
                // Wait for the database to load, then populate products
                setTimeout(() => {
                    if (typeof getAllProductsFromDatabase === 'function') {
                        const databaseProducts = getAllProductsFromDatabase();
                        console.log('âœ… Loaded products from database:', databaseProducts.length);
                        
                        // Add database products to allProducts
                        allProducts = [...databaseProducts];
                        
                        // Assign subcategories and update UI
                        assignSubcategories(allProducts);
                        populateCategories();
                        updateProductCount();
                        
                        showMessage(`Successfully loaded ${databaseProducts.length} products from local database!`, 'success');
                    } else {
                        console.log('âŒ Database functions not available, loading sample data instead');
                        loadEnhancedSampleData();
                    }
                }, 500);
            };
            script.onerror = function() {
                console.log('âŒ Failed to load product database, using sample data instead');
                loadEnhancedSampleData();
            };
            document.head.appendChild(script);
        }
        
        // Load products from our backend database API
        async function loadBackendProducts() {
            try {
                console.log('ðŸ”„ Loading products from backend /api/products...');
                const response = await fetch(`${BACKEND_URL}/api/products?limit=1000`);
                if (!response.ok) {
                    console.log('âŒ Backend products API not available:', response.status);
                    return;
                }
                const backendProducts = await response.json();
                if (!Array.isArray(backendProducts) || backendProducts.length === 0) {
                    console.log('â„¹ï¸ Backend returned no products');
                    return;
                }

                const transformed = backendProducts.map(p => ({
                    id: p.id || `db_${Math.random().toString(36).slice(2)}`,
                    name: p.name,
                    power: Number(p.power) || 0,
                    category: p.category || 'Appliances',
                    subcategory: p.subcategory || null,
                    brand: p.brand || 'Backend',
                    runningCostPerYear: typeof p.runningCostPerYear === 'number' ? p.runningCostPerYear : null,
                    energyRating: p.energyRating || null,
                    efficiency: p.efficiency || null,
                    source: 'Backend',
                    modelNumber: p.modelNumber || null,
                    // Water and capacity fields from backend
                    waterPerCycle: typeof p.waterPerCycle === 'number' ? p.waterPerCycle : null,
                    waterPerYear: typeof p.waterPerYear === 'number' ? p.waterPerYear : null,
                    capacity: typeof p.capacity === 'number' ? p.capacity : null,
                    placeSettings: typeof p.placeSettings === 'number' ? p.placeSettings : null,
                }));

                allProducts = [...allProducts, ...transformed];
                assignSubcategories(allProducts);
                populateCategories();
                updateProductCount();
                showMessage(`Loaded ${transformed.length} products from backend database`, 'success');
            } catch (error) {
                console.log('âŒ Failed to load backend products:', error);
            }
        }

        // Test ETL API connection
        async function testETLConnection() {
            try {
                console.log('ðŸ” Testing ETL API connection...');
                const response = await fetch(`${BACKEND_URL}/api/etl/products?size=10`);
                console.log('ðŸ” ETL API test response status:', response.status);
                console.log('ðŸ” ETL API test response ok:', response.ok);
                
                if (response.ok) {
                    const testData = await response.json();
                    console.log('ðŸ” ETL API test data structure:', testData);
                    console.log('ðŸ” ETL API test data type:', typeof testData);
                    console.log('ðŸ” ETL API test data keys:', testData ? Object.keys(testData) : 'null');
                }
            } catch (error) {
                console.log('ðŸ” ETL API connection test failed:', error);
            }
        }
        
        // Setup event listeners
        function setupEventListeners() {
            document.getElementById('calculate-btn').addEventListener('click', calculateSavings);
            
            // Add event listeners for product selection changes
            document.getElementById('current-product').addEventListener('change', updatePowerBadges);
            document.getElementById('efficient-product').addEventListener('change', updatePowerBadges);
        }
        
        // Load enhanced sample data
        function loadEnhancedSampleData() {
            try {
                console.log('ðŸ”„ Loading enhanced ETL-style sample data...');
                
                const sampleProducts = [
                // Appliances
                { id: 'sample_1', name: 'LG GSL760PZXV 601L French Door Fridge', power: 120, category: 'Appliances', subcategory: 'Refrigerator', brand: 'LG', runningCostPerYear: 52.56, energyRating: 'A+', efficiency: 'High', source: 'Sample' },
                { id: 'sample_2', name: 'Samsung Washing Machine', power: 180, category: 'Appliances', subcategory: 'Washing Machine', brand: 'Samsung', runningCostPerYear: 78.90, energyRating: 'A', efficiency: 'Medium', source: 'Sample' },
                { id: 'sample_3', name: 'Bosch Dishwasher', power: 150, category: 'Appliances', subcategory: 'Dishwasher', brand: 'Bosch', runningCostPerYear: 65.70, energyRating: 'A+', efficiency: 'High', source: 'Sample' },
                { id: 'sample_4', name: 'Whirlpool Microwave', power: 800, category: 'Appliances', subcategory: 'Microwave', brand: 'Whirlpool', runningCostPerYear: 35.04, energyRating: 'B', efficiency: 'Medium', source: 'Sample' },
                { id: 'sample_13', name: 'Miele Washing Machine', power: 160, category: 'Appliances', subcategory: 'Washing Machine', brand: 'Miele', runningCostPerYear: 70.13, energyRating: 'A+', efficiency: 'High', source: 'Sample' },
                { id: 'sample_14', name: 'AEG Dishwasher', power: 140, category: 'Appliances', subcategory: 'Dishwasher', brand: 'AEG', runningCostPerYear: 61.32, energyRating: 'A+', efficiency: 'High', source: 'Sample' },
                { id: 'sample_15', name: 'Siemens Fridge Freezer', power: 110, category: 'Appliances', subcategory: 'Refrigerator', brand: 'Siemens', runningCostPerYear: 48.18, energyRating: 'A+', efficiency: 'High', source: 'Sample' },
                { id: 'sample_16', name: 'Panasonic Microwave', power: 750, category: 'Appliances', subcategory: 'Microwave', brand: 'Panasonic', runningCostPerYear: 32.85, energyRating: 'A', efficiency: 'High', source: 'Sample' },
                
                // Lighting
                { id: 'sample_5', name: 'Philips LED Bulb 9W', power: 9, category: 'Lighting', subcategory: 'LED Bulbs', brand: 'Philips', runningCostPerYear: 3.94, energyRating: 'A+', efficiency: 'High', source: 'Sample' },
                { id: 'sample_6', name: 'Osram LED Tube 18W', power: 18, category: 'Lighting', subcategory: 'LED Tubes', brand: 'Osram', runningCostPerYear: 7.88, energyRating: 'A+', efficiency: 'High', source: 'Sample' },
                { id: 'sample_17', name: 'GE LED Bulb 7W', power: 7, category: 'Lighting', subcategory: 'LED Bulbs', brand: 'GE', runningCostPerYear: 3.07, energyRating: 'A+', efficiency: 'High', source: 'Sample' },
                { id: 'sample_18', name: 'Cree LED Bulb 10W', power: 10, category: 'Lighting', subcategory: 'LED Bulbs', brand: 'Cree', runningCostPerYear: 4.38, energyRating: 'A+', efficiency: 'High', source: 'Sample' },
                { id: 'sample_19', name: 'Sylvania LED Tube 20W', power: 20, category: 'Lighting', subcategory: 'LED Tubes', brand: 'Sylvania', runningCostPerYear: 8.76, energyRating: 'A+', efficiency: 'High', source: 'Sample' },
                { id: 'sample_40', name: 'Feit Electric LED Bulb 6W', power: 6, category: 'Lighting', subcategory: 'LED Bulbs', brand: 'Feit Electric', runningCostPerYear: 2.63, energyRating: 'A+', efficiency: 'High', source: 'Sample' },
                { id: 'sample_41', name: 'MaxLite LED Bulb 8W', power: 8, category: 'Lighting', subcategory: 'LED Bulbs', brand: 'MaxLite', runningCostPerYear: 3.50, energyRating: 'A+', efficiency: 'High', source: 'Sample' },
                { id: 'sample_42', name: 'Lithonia LED Tube 15W', power: 15, category: 'Lighting', subcategory: 'LED Tubes', brand: 'Lithonia', runningCostPerYear: 6.57, energyRating: 'A+', efficiency: 'High', source: 'Sample' },
                { id: 'sample_43', name: 'Cooper Lighting LED Fixture', power: 25, category: 'Lighting', subcategory: 'Fixtures', brand: 'Cooper Lighting', runningCostPerYear: 10.95, energyRating: 'A+', efficiency: 'High', source: 'Sample' },
                
                // Heating
                { id: 'sample_7', name: 'Vaillant Boiler 24kW', power: 24000, category: 'Heating', subcategory: 'Boilers', brand: 'Vaillant', runningCostPerYear: 1051.20, energyRating: 'A', efficiency: 'Medium', source: 'Sample' },
                { id: 'sample_8', name: 'Mitsubishi Heat Pump 5kW', power: 5000, category: 'Heating', subcategory: 'Heat Pumps', brand: 'Mitsubishi', runningCostPerYear: 219.00, energyRating: 'A+', efficiency: 'High', source: 'Sample' },
                { id: 'sample_20', name: 'Worcester Boiler 30kW', power: 30000, category: 'Heating', subcategory: 'Boilers', brand: 'Worcester', runningCostPerYear: 1314.00, energyRating: 'A', efficiency: 'Medium', source: 'Sample' },
                { id: 'sample_21', name: 'Daikin Heat Pump 7kW', power: 7000, category: 'Heating', subcategory: 'Heat Pumps', brand: 'Daikin', runningCostPerYear: 306.60, energyRating: 'A+', efficiency: 'High', source: 'Sample' },
                { id: 'sample_22', name: 'Baxi Boiler 18kW', power: 18000, category: 'Heating', subcategory: 'Boilers', brand: 'Baxi', runningCostPerYear: 788.40, energyRating: 'B', efficiency: 'Medium', source: 'Sample' },
                { id: 'sample_36', name: 'Ideal Boiler 25kW', power: 25000, category: 'Heating', subcategory: 'Boilers', brand: 'Ideal', runningCostPerYear: 1095.00, energyRating: 'A', efficiency: 'Medium', source: 'Sample' },
                { id: 'sample_37', name: 'Glow-worm Boiler 20kW', power: 20000, category: 'Heating', subcategory: 'Boilers', brand: 'Glow-worm', runningCostPerYear: 876.00, energyRating: 'B', efficiency: 'Medium', source: 'Sample' },
                { id: 'sample_38', name: 'Fujitsu Heat Pump 3kW', power: 3000, category: 'Heating', subcategory: 'Heat Pumps', brand: 'Fujitsu', runningCostPerYear: 131.40, energyRating: 'A+', efficiency: 'High', source: 'Sample' },
                { id: 'sample_39', name: 'Panasonic Heat Pump 4kW', power: 4000, category: 'Heating', subcategory: 'Heat Pumps', brand: 'Panasonic', runningCostPerYear: 175.20, energyRating: 'A+', efficiency: 'High', source: 'Sample' },
                
                // Renewable
                { id: 'sample_9', name: 'Solar Panel 300W', power: -300, category: 'Renewable', subcategory: 'Solar Panels', brand: 'Generic', runningCostPerYear: -131.40, energyRating: 'A+', efficiency: 'High', source: 'Sample' },
                { id: 'sample_10', name: 'Wind Turbine 1kW', power: -1000, category: 'Renewable', subcategory: 'Wind Turbines', brand: 'Generic', runningCostPerYear: -438.00, energyRating: 'A+', efficiency: 'High', source: 'Sample' },
                { id: 'sample_23', name: 'Solar Panel 400W', power: -400, category: 'Renewable', subcategory: 'Solar Panels', brand: 'Generic', runningCostPerYear: -175.20, energyRating: 'A+', efficiency: 'High', source: 'Sample' },
                { id: 'sample_24', name: 'Solar Panel 500W', power: -500, category: 'Renewable', subcategory: 'Solar Panels', brand: 'Generic', runningCostPerYear: -219.00, energyRating: 'A+', efficiency: 'High', source: 'Sample' },
                { id: 'sample_25', name: 'Wind Turbine 2kW', power: -2000, category: 'Renewable', subcategory: 'Wind Turbines', brand: 'Generic', runningCostPerYear: -876.00, energyRating: 'A+', efficiency: 'High', source: 'Sample' },
                
                // Smart Home
                { id: 'sample_11', name: 'Nest Thermostat', power: 5, category: 'Smart Home', subcategory: 'Thermostats', brand: 'Nest', runningCostPerYear: 2.19, energyRating: 'A+', efficiency: 'High', source: 'Sample' },
                { id: 'sample_12', name: 'Philips Hue Bridge', power: 2, category: 'Smart Home', subcategory: 'Hubs', brand: 'Philips', runningCostPerYear: 0.88, energyRating: 'A+', efficiency: 'High', source: 'Sample' },
                { id: 'sample_26', name: 'Ecobee Thermostat', power: 4, category: 'Smart Home', subcategory: 'Thermostats', brand: 'Ecobee', runningCostPerYear: 1.75, energyRating: 'A+', efficiency: 'High', source: 'Sample' },
                { id: 'sample_27', name: 'Honeywell Smart Thermostat', power: 6, category: 'Smart Home', subcategory: 'Thermostats', brand: 'Honeywell', runningCostPerYear: 2.63, energyRating: 'A+', efficiency: 'High', source: 'Sample' },
                { id: 'sample_28', name: 'Samsung SmartThings Hub', power: 3, category: 'Smart Home', subcategory: 'Hubs', brand: 'Samsung', runningCostPerYear: 1.31, energyRating: 'A+', efficiency: 'High', source: 'Sample' },
                { id: 'sample_29', name: 'Apple HomeKit Hub', power: 2, category: 'Smart Home', subcategory: 'Hubs', brand: 'Apple', runningCostPerYear: 0.88, energyRating: 'A+', efficiency: 'High', source: 'Sample' },
                { id: 'sample_30', name: 'Ring Doorbell Pro', power: 8, category: 'Smart Home', subcategory: 'Sensors', brand: 'Ring', runningCostPerYear: 3.50, energyRating: 'A+', efficiency: 'High', source: 'Sample' },
                { id: 'sample_31', name: 'Arlo Security Camera', power: 12, category: 'Smart Home', subcategory: 'Sensors', brand: 'Arlo', runningCostPerYear: 5.26, energyRating: 'A+', efficiency: 'High', source: 'Sample' },
                { id: 'sample_32', name: 'Eufy Security Camera', power: 10, category: 'Smart Home', subcategory: 'Sensors', brand: 'Eufy', runningCostPerYear: 4.38, energyRating: 'A+', efficiency: 'High', source: 'Sample' },
                { id: 'sample_33', name: 'Indesit Washing Machine', power: 200, category: 'Appliances', subcategory: 'Washing Machine', brand: 'Indesit', runningCostPerYear: 87.60, energyRating: 'B', efficiency: 'Medium', source: 'Sample' },
                { id: 'sample_34', name: 'Hotpoint Fridge Freezer', power: 130, category: 'Appliances', subcategory: 'Refrigerator', brand: 'Hotpoint', runningCostPerYear: 56.94, energyRating: 'A', efficiency: 'Medium', source: 'Sample' },
                { id: 'sample_35', name: 'Zanussi Dishwasher', power: 160, category: 'Appliances', subcategory: 'Dishwasher', brand: 'Zanussi', runningCostPerYear: 70.13, energyRating: 'A', efficiency: 'Medium', source: 'Sample' },
                { id: 'sample_44', name: 'Beko Washing Machine', power: 190, category: 'Appliances', subcategory: 'Washing Machine', brand: 'Beko', runningCostPerYear: 83.22, energyRating: 'B', efficiency: 'Medium', source: 'Sample' },
                { id: 'sample_45', name: 'Candy Fridge Freezer', power: 125, category: 'Appliances', subcategory: 'Refrigerator', brand: 'Candy', runningCostPerYear: 54.75, energyRating: 'A', efficiency: 'Medium', source: 'Sample' },
                { id: 'sample_46', name: 'Sharp Microwave', power: 850, category: 'Appliances', subcategory: 'Microwave', brand: 'Sharp', runningCostPerYear: 37.23, energyRating: 'B', efficiency: 'Medium', source: 'Sample' },
                { id: 'sample_47', name: 'Toshiba Microwave', power: 900, category: 'Appliances', subcategory: 'Microwave', brand: 'Toshiba', runningCostPerYear: 39.42, energyRating: 'B', efficiency: 'Medium', source: 'Sample' },
                { id: 'sample_48', name: 'Electrolux Washing Machine', power: 170, category: 'Appliances', subcategory: 'Washing Machine', brand: 'Electrolux', runningCostPerYear: 74.49, energyRating: 'A', efficiency: 'Medium', source: 'Sample' },
                { id: 'sample_49', name: 'Haier Fridge Freezer', power: 135, category: 'Appliances', subcategory: 'Refrigerator', brand: 'Haier', runningCostPerYear: 59.13, energyRating: 'A', efficiency: 'Medium', source: 'Sample' },
                { id: 'sample_50', name: 'Hisense Dishwasher', power: 155, category: 'Appliances', subcategory: 'Dishwasher', brand: 'Hisense', runningCostPerYear: 67.89, energyRating: 'A', efficiency: 'Medium', source: 'Sample' },
                
                // NEW: Ovens - 10 products
                { id: 'oven_1', name: 'Bosch HBL8453UC 30" Single Wall Oven', power: 2400, category: 'Appliances', subcategory: 'Oven', brand: 'Bosch', runningCostPerYear: 105.12, energyRating: 'A+', efficiency: 'High', source: 'Sample' },
                { id: 'oven_2', name: 'Miele H2265B 30" Single Wall Oven', power: 2300, category: 'Appliances', subcategory: 'Oven', brand: 'Miele', runningCostPerYear: 100.74, energyRating: 'A+', efficiency: 'High', source: 'Sample' },
                { id: 'oven_3', name: 'KitchenAid KOCE500ESS 30" Single Wall Oven', power: 2500, category: 'Appliances', subcategory: 'Oven', brand: 'KitchenAid', runningCostPerYear: 109.50, energyRating: 'A', efficiency: 'Medium', source: 'Sample' },
                { id: 'oven_4', name: 'Samsung NE58K9560WS 30" Single Wall Oven', power: 2450, category: 'Appliances', subcategory: 'Oven', brand: 'Samsung', runningCostPerYear: 107.31, energyRating: 'A', efficiency: 'Medium', source: 'Sample' },
                { id: 'oven_5', name: 'LG LSE4613ST 30" Single Wall Oven', power: 2350, category: 'Appliances', subcategory: 'Oven', brand: 'LG', runningCostPerYear: 102.93, energyRating: 'A', efficiency: 'Medium', source: 'Sample' },
                { id: 'oven_6', name: 'Whirlpool WOS51EC0HS 30" Single Wall Oven', power: 2600, category: 'Appliances', subcategory: 'Oven', brand: 'Whirlpool', runningCostPerYear: 113.88, energyRating: 'A', efficiency: 'Medium', source: 'Sample' },
                { id: 'oven_7', name: 'GE Profile JBS86SPSS 30" Single Wall Oven', power: 2550, category: 'Appliances', subcategory: 'Oven', brand: 'GE', runningCostPerYear: 111.69, energyRating: 'A', efficiency: 'Medium', source: 'Sample' },
                { id: 'oven_8', name: 'Maytag MGR8875AD 30" Single Wall Oven', power: 2700, category: 'Appliances', subcategory: 'Oven', brand: 'Maytag', runningCostPerYear: 118.26, energyRating: 'A', efficiency: 'Medium', source: 'Sample' },
                { id: 'oven_9', name: 'Frigidaire FEFWS366LWA 30" Single Wall Oven', power: 2650, category: 'Appliances', subcategory: 'Oven', brand: 'Frigidaire', runningCostPerYear: 116.07, energyRating: 'A', efficiency: 'Medium', source: 'Sample' },
                { id: 'oven_10', name: 'Electrolux EI30EF55QS 30" Single Wall Oven', power: 2750, category: 'Appliances', subcategory: 'Oven', brand: 'Electrolux', runningCostPerYear: 120.45, energyRating: 'A', efficiency: 'Medium', source: 'Sample' },
                
                // NEW: Restaurant Equipment - 10 products
                { id: 'rest_oven_1', name: 'Vulcan VC4GD 4-Burner Gas Range', power: 15000, category: 'Restaurant Equipment', subcategory: 'Commercial Ovens', brand: 'Vulcan', runningCostPerYear: 657.00, energyRating: 'A', efficiency: 'Medium', source: 'Sample' },
                { id: 'rest_oven_2', name: 'Wolf CR304 30" Gas Range', power: 18000, category: 'Restaurant Equipment', subcategory: 'Commercial Ovens', brand: 'Wolf', runningCostPerYear: 788.40, energyRating: 'A', efficiency: 'Medium', source: 'Sample' },
                { id: 'rest_oven_3', name: 'Blodgett BLT-1000 Convection Oven', power: 12000, category: 'Restaurant Equipment', subcategory: 'Commercial Ovens', brand: 'Blodgett', runningCostPerYear: 525.60, energyRating: 'A+', efficiency: 'High', source: 'Sample' },
                { id: 'rest_fridge_1', name: 'True T-49-HC Commercial Refrigerator', power: 800, category: 'Restaurant Equipment', subcategory: 'Commercial Fridges', brand: 'True', runningCostPerYear: 350.40, energyRating: 'A+', efficiency: 'High', source: 'Sample' },
                { id: 'rest_fridge_2', name: 'Beverage Air BM23 Commercial Refrigerator', power: 750, category: 'Restaurant Equipment', subcategory: 'Commercial Fridges', brand: 'Beverage Air', runningCostPerYear: 328.50, energyRating: 'A+', efficiency: 'High', source: 'Sample' },
                { id: 'rest_prep_1', name: 'Hobart N50 Mixer 5qt', power: 600, category: 'Restaurant Equipment', subcategory: 'Food Prep', brand: 'Hobart', runningCostPerYear: 262.80, energyRating: 'A+', efficiency: 'High', source: 'Sample' },
                { id: 'rest_prep_2', name: 'KitchenAid Commercial Mixer 6qt', power: 500, category: 'Restaurant Equipment', subcategory: 'Food Prep', brand: 'KitchenAid', runningCostPerYear: 219.00, energyRating: 'A+', efficiency: 'High', source: 'Sample' },
                { id: 'rest_prep_3', name: 'Robot Coupe R2 Food Processor', power: 400, category: 'Restaurant Equipment', subcategory: 'Food Prep', brand: 'Robot Coupe', runningCostPerYear: 175.20, energyRating: 'A+', efficiency: 'High', source: 'Sample' },
                { id: 'rest_prep_4', name: 'Vollrath Food Slicer 12"', power: 300, category: 'Restaurant Equipment', subcategory: 'Food Prep', brand: 'Vollrath', runningCostPerYear: 131.40, energyRating: 'A+', efficiency: 'High', source: 'Sample' },
                { id: 'rest_prep_5', name: 'Berkel Commercial Meat Slicer', power: 350, category: 'Restaurant Equipment', subcategory: 'Food Prep', brand: 'Berkel', runningCostPerYear: 153.30, energyRating: 'A+', efficiency: 'High', source: 'Sample' },
                
                // NEW: Office Equipment - 10 products
                { id: 'office_comp_1', name: 'Dell OptiPlex 7090 Desktop', power: 180, category: 'Office Equipment', subcategory: 'Computers', brand: 'Dell', runningCostPerYear: 78.84, energyRating: 'A+', efficiency: 'High', source: 'Sample' },
                { id: 'office_comp_2', name: 'HP EliteDesk 800 G5 Desktop', power: 200, category: 'Office Equipment', subcategory: 'Computers', brand: 'HP', runningCostPerYear: 87.60, energyRating: 'A+', efficiency: 'High', source: 'Sample' },
                { id: 'office_laptop_1', name: 'Dell Latitude 5520 Laptop', power: 65, category: 'Office Equipment', subcategory: 'Laptops', brand: 'Dell', runningCostPerYear: 28.47, energyRating: 'A+', efficiency: 'High', source: 'Sample' },
                { id: 'office_laptop_2', name: 'HP EliteBook 840 G8 Laptop', power: 70, category: 'Office Equipment', subcategory: 'Laptops', brand: 'HP', runningCostPerYear: 30.66, energyRating: 'A+', efficiency: 'High', source: 'Sample' },
                { id: 'office_printer_1', name: 'HP LaserJet Pro M404n Printer', power: 350, category: 'Office Equipment', subcategory: 'Printers', brand: 'HP', runningCostPerYear: 153.30, energyRating: 'A+', efficiency: 'High', source: 'Sample' },
                { id: 'office_printer_2', name: 'Canon imageRUNNER ADVANCE C2500 Printer', power: 1200, category: 'Office Equipment', subcategory: 'Printers', brand: 'Canon', runningCostPerYear: 525.60, energyRating: 'A', efficiency: 'Medium', source: 'Sample' },
                { id: 'office_monitor_1', name: 'Dell UltraSharp U2720Q 27" Monitor', power: 25, category: 'Office Equipment', subcategory: 'Monitors', brand: 'Dell', runningCostPerYear: 10.95, energyRating: 'A+', efficiency: 'High', source: 'Sample' },
                { id: 'office_monitor_2', name: 'HP E27m G4 27" Monitor', power: 30, category: 'Office Equipment', subcategory: 'Monitors', brand: 'HP', runningCostPerYear: 13.14, energyRating: 'A+', efficiency: 'High', source: 'Sample' },
                { id: 'office_network_1', name: 'Cisco Catalyst 2960 Switch', power: 150, category: 'Office Equipment', subcategory: 'Networking', brand: 'Cisco', runningCostPerYear: 65.70, energyRating: 'A+', efficiency: 'High', source: 'Sample' },
                { id: 'office_network_2', name: 'Netgear GS108 Switch', power: 8, category: 'Office Equipment', subcategory: 'Networking', brand: 'Netgear', runningCostPerYear: 3.50, energyRating: 'A+', efficiency: 'High', source: 'Sample' }
            ];
            
            allProducts = [...sampleProducts];
            console.log('âœ… Loaded enhanced ETL-style data:', allProducts.length, 'products');
            console.log('ðŸ” Sample products:', sampleProducts.length);
            console.log('ðŸ” All products after assignment:', allProducts.length);
            
            // Assign subcategories and update UI
            assignSubcategories(allProducts);
            console.log('ðŸ” After assignSubcategories:', allProducts.length);
            populateCategories();
            console.log('ðŸ” After populateCategories');
            updateProductCount();
            console.log('ðŸ” After updateProductCount');
            } catch (error) {
                console.error('âŒ Error loading sample data:', error);
                // Set a minimal fallback
                allProducts = [
                    { id: 'fallback_1', name: 'Fallback Product', power: 100, category: 'Appliances', subcategory: 'Other', brand: 'Generic', runningCostPerYear: 43.80, energyRating: 'A', efficiency: 'Medium', source: 'Fallback' }
                ];
                console.log('âœ… Loaded fallback product');
            }
        }
        
        // Helper functions for local database (currently disabled)
        function getAllProductsFromDatabase() {
            return []; // Return empty array until we fix the database
        }
        
        function getProductsByCategory(category) {
            return []; // Return empty array until we fix the database
        }
        
        function getProductsBySubcategory(subcategory) {
            return []; // Return empty array until we fix the database
        }
        
        // Load products from local database (currently disabled)
        function loadLocalDatabaseProducts() {
            console.log('ðŸ”„ Local database loading is currently disabled');
            return [];
        }
        
        // Load real products from ETL API
        async function loadRealProducts() {
            try {
                console.log('ðŸ”„ Loading real products from ETL API...');
                
                // Try different size parameters to get more products
                const sizeOptions = [50, 100, 200, 500, 1000];
                let productsArray = [];
                let successfulSize = 0;
                
                for (const size of sizeOptions) {
                    try {
                        console.log(`ðŸ”„ Trying ETL API with size=${size}...`);
                        const response = await fetch(`${BACKEND_URL}/api/etl/products?size=${size}`);
                        
                        if (response.ok) {
                            const realProducts = await response.json();
                            console.log(`âœ… ETL API response with size=${size}:`, realProducts);
                            console.log(`ðŸ“Š Response type:`, typeof realProducts);
                            console.log(`ðŸ“Š Response keys:`, realProducts ? Object.keys(realProducts) : 'null');
                            console.log(`ðŸ“Š Is array:`, Array.isArray(realProducts));
                            
                            // Handle different response formats
                            let currentProducts = realProducts;
                            if (realProducts && typeof realProducts === 'object') {
                                if (realProducts.products && Array.isArray(realProducts.products)) {
                                    currentProducts = realProducts.products;
                                    console.log(`ðŸ“Š Found products array with ${currentProducts.length} items`);
                                } else if (realProducts.data && Array.isArray(realProducts.data)) {
                                    currentProducts = realProducts.data;
                                    console.log(`ðŸ“Š Found data array with ${currentProducts.length} items`);
                                } else if (Array.isArray(realProducts)) {
                                    currentProducts = realProducts;
                                    console.log(`ðŸ“Š Response is direct array with ${currentProducts.length} items`);
                                } else {
                                    currentProducts = [];
                                    console.log(`ðŸ“Š No recognizable array structure found`);
                                }
                            }
                            
                            if (currentProducts && Array.isArray(currentProducts) && currentProducts.length > 0) {
                                console.log(`âœ… Found ${currentProducts.length} products with size=${size}`);
                                productsArray = currentProducts;
                                successfulSize = size;
                                break; // Use the first successful response
                            } else {
                                console.log(`âŒ No valid products found with size=${size}`);
                            }
                        } else {
                            console.log(`âŒ ETL API response not ok with size=${size}:`, response.status, response.statusText);
                        }
                    } catch (sizeError) {
                        console.log(`âŒ Failed to load products with size=${size}:`, sizeError);
                    }
                }
                
                if (productsArray && Array.isArray(productsArray) && productsArray.length > 0) {
                    console.log('âœ… Processing', productsArray.length, 'real products');
                    
                    // Transform real products to match our format
                    const transformedProducts = productsArray.map(product => {
                        // Extract power from features
                        const power = extractPowerFromFeatures(product.features) || 100;
                        // Extract energy rating from features
                        const energyRating = extractEnergyRatingFromFeatures(product.features) || 'A+';
                        // Get technology name for category
                        const category = getTechnologyName(product.technologyId) || 'Appliances';
                        // Get manufacturer name for brand
                        const brand = product.manufacturer ? (product.manufacturer.name || 'ETL Certified') : 'ETL Certified';
                        // Calculate running cost
                        const runningCostPerYear = calculateRunningCost(power, 0.15, 8);
                        // Determine efficiency
                        const efficiency = determineEfficiency(energyRating);
                        
                        return {
                            id: `etl_${product.id}`,
                            name: product.name || 'ETL Product',
                            power: power,
                            category: category,
                            subcategory: null, // Will be assigned by assignSubcategories
                            brand: brand,
                            runningCostPerYear: runningCostPerYear,
                            energyRating: energyRating,
                            efficiency: efficiency,
                            source: 'ETL',
                            modelNumber: product.modelNumber || `ETL-${product.id}`
                        };
                    });
                    
                    console.log('âœ… Transformed products:', transformedProducts.length);
                    
                    // Add transformed products to allProducts (don't replace)
                    allProducts = [...allProducts, ...transformedProducts];
                    
                    // Assign subcategories to all products
                    assignSubcategories(allProducts);
                    
                    // Update filtering and display
                    populateCategories();
                    updateProductCount();
                    
                    showMessage(`Successfully loaded ${transformedProducts.length} real ETL products! Total: ${allProducts.length} products`, 'success');
                } else {
                    console.log('âŒ No valid products found in any ETL API response');
                    showMessage('ETL API returned no valid products - using sample data', 'info');
                }
            } catch (error) {
                console.log('âŒ Failed to load real products:', error);
                showMessage('ETL API connection failed - using sample data', 'info');
            }
        }
        
        // Load Energy Star certified products
        async function loadEnergyStarProducts() {
            try {
                console.log('ðŸ”„ Loading Energy Star certified products...');
                
                // Try multiple Energy Star endpoints with different limits
                const endpoints = [
                    'https://data.energystar.gov/resource/8bne-dm2k.json?$limit=200',
                    'https://data.energystar.gov/resource/5c29-5upz.json?$limit=200',
                    'https://data.energystar.gov/resource/8bne-dm2k.json?$limit=100',
                    'https://data.energystar.gov/resource/5c29-5upz.json?$limit=100'
                ];
                
                let energyStarProducts = [];
                let endpointIndex = 0;
                
                while (energyStarProducts.length === 0 && endpointIndex < endpoints.length) {
                    try {
                        console.log(`ðŸ”„ Trying Energy Star endpoint ${endpointIndex + 1}: ${endpoints[endpointIndex]}`);
                        const response = await fetch(endpoints[endpointIndex]);
                        
                        console.log(`ðŸ“Š Energy Star response status:`, response.status, response.statusText);
                        console.log(`ðŸ“Š Energy Star response headers:`, response.headers);
                        
                        if (response.ok) {
                            const products = await response.json();
                            console.log(`ðŸ“Š Energy Star response data:`, products);
                            console.log(`ðŸ“Š Energy Star response type:`, typeof products);
                            console.log(`ðŸ“Š Energy Star response is array:`, Array.isArray(products));
                            console.log(`ðŸ“Š Energy Star response length:`, products ? products.length : 'null');
                            
                            if (products && Array.isArray(products) && products.length > 0) {
                                energyStarProducts = products;
                                console.log(`âœ… Successfully loaded ${products.length} products from endpoint ${endpointIndex + 1}`);
                                break;
                            } else {
                                console.log(`âŒ Endpoint ${endpointIndex + 1} returned no valid products`);
                            }
                        } else {
                            console.log(`âŒ Energy Star endpoint ${endpointIndex + 1} failed with status:`, response.status);
                        }
                    } catch (endpointError) {
                        console.log(`âŒ Endpoint ${endpointIndex + 1} failed:`, endpointError);
                        console.log(`âŒ Error details:`, endpointError.message);
                    }
                    endpointIndex++;
                }
                
                // If no Energy Star products loaded, create some fallback Energy Star-style products
                if (energyStarProducts.length === 0) {
                    console.log('ðŸ”„ Creating fallback Energy Star products...');
                    energyStarProducts = createFallbackEnergyStarProducts();
                }
                
                if (energyStarProducts && Array.isArray(energyStarProducts) && energyStarProducts.length > 0) {
                    // Transform Energy Star products to match our format
                    const transformedProducts = energyStarProducts.map((product, index) => {
                        // Extract power from various fields
                        let power = 100; // Default power
                        if (product.annual_energy_use_kwh) {
                            power = (product.annual_energy_use_kwh * 1000) / 8760; // Convert annual kWh to watts
                        } else if (product.rated_power_watts) {
                            power = parseFloat(product.rated_power_watts) || 100;
                        } else if (product.power) {
                            power = product.power;
                        }
                        
                        // Determine category based on product type
                        let category = 'Appliances';
                        if (product.product_type && product.product_type.toLowerCase().includes('light')) {
                            category = 'Lighting';
                        } else if (product.product_type && product.product_type.toLowerCase().includes('heat')) {
                            category = 'Heating';
                        } else if (product.product_type && product.product_type.toLowerCase().includes('solar')) {
                            category = 'Renewable';
                        } else if (product.category) {
                            category = product.category;
                        }
                        
                        // Calculate running cost
                        const runningCostPerYear = calculateRunningCost(power, 0.15, 8);
                        
                        return {
                            id: `energystar_${index}`,
                            name: product.product_name || product.name || `Energy Star ${product.product_type || 'Product'}`,
                            power: power,
                            category: category,
                            subcategory: null, // Will be assigned by assignSubcategories
                            brand: product.brand_name || product.brand || 'Energy Star Certified',
                            runningCostPerYear: runningCostPerYear,
                            energyRating: 'A+', // Energy Star products are highly efficient
                            efficiency: 'High',
                            source: 'Energy Star',
                            modelNumber: product.model_number || product.modelNumber || `ES-${index}`
                        };
                    });
                    
                    console.log('âœ… Transformed Energy Star products:', transformedProducts.length);
                    
                    // Add Energy Star products to allProducts
                    allProducts = [...allProducts, ...transformedProducts];
                    
                    // Assign subcategories and update UI
                    assignSubcategories(allProducts);
                    populateCategories();
                    updateProductCount();
                    
                    showMessage(`Successfully loaded ${transformedProducts.length} Energy Star products! Total: ${allProducts.length} products`, 'success');
                } else {
                    console.log('âŒ No valid Energy Star products found from any endpoint');
                }
            } catch (error) {
                console.log('âŒ Failed to load Energy Star products:', error);
                // Create fallback products even if API fails
                const fallbackProducts = createFallbackEnergyStarProducts();
                if (fallbackProducts.length > 0) {
                    console.log('ðŸ”„ Adding fallback Energy Star products after API failure...');
                    const transformedFallbacks = fallbackProducts.map((product, index) => ({
                        id: `energystar_fallback_${index}`,
                        name: product.name,
                        power: product.power,
                        category: product.category,
                        subcategory: null,
                        brand: product.brand,
                        runningCostPerYear: calculateRunningCost(product.power, 0.15, 8),
                        energyRating: 'A+',
                        efficiency: 'High',
                        source: 'Energy Star',
                        modelNumber: `ES-FB-${index}`
                    }));
                    
                    allProducts = [...allProducts, ...transformedFallbacks];
                    assignSubcategories(allProducts);
                    populateCategories();
                    updateProductCount();
                    
                    showMessage(`Added ${transformedFallbacks.length} fallback Energy Star products! Total: ${allProducts.length} products`, 'success');
                }
            }
        }
        
        // Create fallback Energy Star products if API fails
        function createFallbackEnergyStarProducts() {
            return [
                // Energy Star Appliances
                { name: 'Energy Star Samsung Refrigerator', power: 95, category: 'Appliances', brand: 'Samsung' },
                { name: 'Energy Star LG Washing Machine', power: 150, category: 'Appliances', brand: 'LG' },
                { name: 'Energy Star Bosch Dishwasher', power: 130, category: 'Appliances', brand: 'Bosch' },
                { name: 'Energy Star Whirlpool Microwave', power: 700, category: 'Appliances', brand: 'Whirlpool' },
                { name: 'Energy Star GE Refrigerator', power: 100, category: 'Appliances', brand: 'GE' },
                { name: 'Energy Star Maytag Washing Machine', power: 160, category: 'Appliances', brand: 'Maytag' },
                { name: 'Energy Star KitchenAid Dishwasher', power: 140, category: 'Appliances', brand: 'KitchenAid' },
                { name: 'Energy Star Frigidaire Microwave', power: 750, category: 'Appliances', brand: 'Frigidaire' },
                
                // Energy Star Lighting
                { name: 'Energy Star Philips LED Bulb 8W', power: 8, category: 'Lighting', brand: 'Philips' },
                { name: 'Energy Star GE LED Bulb 6W', power: 6, category: 'Lighting', brand: 'GE' },
                { name: 'Energy Star Cree LED Bulb 9W', power: 9, category: 'Lighting', brand: 'Cree' },
                { name: 'Energy Star Osram LED Tube 16W', power: 16, category: 'Lighting', brand: 'Osram' },
                { name: 'Energy Star Sylvania LED Tube 18W', power: 18, category: 'Lighting', brand: 'Sylvania' },
                { name: 'Energy Star Lithonia LED Fixture', power: 22, category: 'Lighting', brand: 'Lithonia' },
                
                // Energy Star Heating
                { name: 'Energy Star Carrier Heat Pump 4kW', power: 4000, category: 'Heating', brand: 'Carrier' },
                { name: 'Energy Star Trane Heat Pump 5kW', power: 5000, category: 'Heating', brand: 'Trane' },
                { name: 'Energy Star Lennox Heat Pump 6kW', power: 6000, category: 'Heating', brand: 'Lennox' },
                { name: 'Energy Star Rheem Boiler 22kW', power: 22000, category: 'Heating', brand: 'Rheem' },
                { name: 'Energy Star Bryant Boiler 26kW', power: 26000, category: 'Heating', brand: 'Bryant' },
                
                // Energy Star Smart Home
                { name: 'Energy Star Ecobee Smart Thermostat', power: 3, category: 'Smart Home', brand: 'Ecobee' },
                { name: 'Energy Star Honeywell Smart Thermostat', power: 4, category: 'Smart Home', brand: 'Honeywell' },
                { name: 'Energy Star Nest Learning Thermostat', power: 3, category: 'Smart Home', brand: 'Nest' },
                { name: 'Energy Star Samsung SmartThings Hub', power: 2, category: 'Smart Home', brand: 'Samsung' }
            ];
        }
        
        // Helper function to extract power from ETL features
        function extractPowerFromFeatures(features) {
            if (!features || !Array.isArray(features)) return null;
            
            for (const feature of features) {
                if (feature.name && feature.name.toLowerCase().includes('power') && feature.numericValue) {
                    return feature.numericValue;
                }
                if (feature.name && feature.name.toLowerCase().includes('watt') && feature.numericValue) {
                    return feature.numericValue;
                }
                if (feature.name && feature.name.toLowerCase().includes('consumption') && feature.numericValue) {
                    return feature.numericValue;
                }
            }
            return null;
        }
        
        // Helper function to extract energy rating from ETL features
        function extractEnergyRatingFromFeatures(features) {
            if (!features || !Array.isArray(features)) return null;
            
            for (const feature of features) {
                if (feature.name && feature.name.toLowerCase().includes('rating') && feature.value) {
                    return feature.value.toString();
                }
                if (feature.name && feature.name.toLowerCase().includes('efficiency') && feature.value) {
                    return feature.value;
                }
            }
            return null;
        }
        
        // Helper function to get technology name from ETL
        function getTechnologyName(technologyId) {
            const technologyMap = {
                1: 'Appliances',
                2: 'Electronics',
                3: 'Lighting',
                4: 'HVAC',
                5: 'Renewable',
                6: 'Smart Home'
            };
            return technologyMap[technologyId] || 'Appliances';
        }
        
        // Helper function to calculate running cost
        function calculateRunningCost(power, rate, hours) {
            return (power / 1000) * rate * hours * 365;
        }
        
        // Helper function to determine efficiency
        function determineEfficiency(rating) {
            if (rating === 'A+' || rating === 'A') return 'High';
            if (rating === 'B' || rating === 'C') return 'Medium';
            return 'Low';
        }
        
        // Assign subcategories to products
        function assignSubcategories(products) {
            products.forEach(product => {
                if (!product.subcategory) {
                    if (product.category === 'Appliances') {
                        if (product.name.toLowerCase().includes('fridge') || product.name.toLowerCase().includes('refrigerator')) {
                            product.subcategory = 'Refrigerator';
                        } else if (product.name.toLowerCase().includes('washing') || product.name.toLowerCase().includes('washer')) {
                            product.subcategory = 'Washing Machine';
                        } else if (product.name.toLowerCase().includes('dishwasher')) {
                            product.subcategory = 'Dishwasher';
                        } else if (product.name.toLowerCase().includes('oven')) {
                            product.subcategory = 'Oven';
                        } else if (product.name.toLowerCase().includes('microwave')) {
                            product.subcategory = 'Microwave';
                        } else {
                            product.subcategory = 'Other';
                        }
                    } else if (product.category === 'Lighting') {
                        if (product.name.toLowerCase().includes('bulb')) {
                            product.subcategory = 'LED Bulbs';
                        } else if (product.name.toLowerCase().includes('tube')) {
                            product.subcategory = 'LED Tubes';
                        } else {
                            product.subcategory = 'Fixtures';
                        }
                    } else if (product.category === 'Heating') {
                        if (product.name.toLowerCase().includes('boiler')) {
                            product.subcategory = 'Boilers';
                        } else if (product.name.toLowerCase().includes('heat pump')) {
                            product.subcategory = 'Heat Pumps';
                        } else {
                            product.subcategory = 'Other';
                        }
                    } else if (product.category === 'Renewable') {
                        if (product.name.toLowerCase().includes('solar')) {
                            product.subcategory = 'Solar Panels';
                        } else if (product.name.toLowerCase().includes('wind')) {
                            product.subcategory = 'Wind Turbines';
                        } else {
                            product.subcategory = 'Other';
                        }
                    } else if (product.category === 'Smart Home') {
                        if (product.name.toLowerCase().includes('thermostat')) {
                            product.subcategory = 'Thermostats';
                        } else if (product.name.toLowerCase().includes('hub') || product.name.toLowerCase().includes('bridge')) {
                            product.subcategory = 'Hubs';
                        } else {
                            product.subcategory = 'Sensors';
                        }
                    } else if (product.category === 'Restaurant Equipment') {
                        if (product.name.toLowerCase().includes('oven')) {
                            product.subcategory = 'Commercial Ovens';
                        } else if (product.name.toLowerCase().includes('fridge') || product.name.toLowerCase().includes('refrigerator')) {
                            product.subcategory = 'Commercial Fridges';
                        } else if (product.name.toLowerCase().includes('freezer') || product.name.toLowerCase().includes('ice')) {
                            product.subcategory = 'Commercial Freezers';
                        } else {
                            product.subcategory = 'Food Prep';
                        }
                    } else if (product.category === 'Office Equipment') {
                        if (product.name.toLowerCase().includes('desktop') || product.name.toLowerCase().includes('computer')) {
                            product.subcategory = 'Computers';
                        } else if (product.name.toLowerCase().includes('laptop')) {
                            product.subcategory = 'Laptops';
                        } else if (product.name.toLowerCase().includes('printer')) {
                            product.subcategory = 'Printers';
                        } else if (product.name.toLowerCase().includes('monitor')) {
                            product.subcategory = 'Monitors';
                        } else if (product.name.toLowerCase().includes('switch') || product.name.toLowerCase().includes('router') || product.name.toLowerCase().includes('access point')) {
                            product.subcategory = 'Networking';
                        } else {
                            product.subcategory = 'Other';
                        }
                    } else {
                        product.subcategory = 'Other';
                    }
                }
            });
        }
        
        // Populate categories and subcategories
        function populateCategories() {
            const categories = ['all', 'Appliances', 'Lighting', 'Heating', 'Renewable', 'Smart Home', 'Restaurant Equipment', 'Office Equipment'];
            const categoryGrid = document.getElementById('category-grid');
            
            categoryGrid.innerHTML = categories.map(category => {
                const displayName = category === 'all' ? 'All Categories' : category;
                const description = category === 'all' ? 'Show all products' : 
                    category === 'Appliances' ? 'Fridges, washing machines, ovens, etc.' :
                    category === 'Lighting' ? 'LED bulbs, fixtures' :
                    category === 'Heating' ? 'Boilers, heat pumps' :
                    category === 'Renewable' ? 'Solar panels, wind' :
                    category === 'Smart Home' ? 'Thermostats, sensors' :
                    category === 'Restaurant Equipment' ? 'Commercial ovens, fridges, food prep' :
                    'Computers, printers, monitors';
                
                return `
                    <div class="category-option" onclick="selectCategory('${category}')">
                        <h4>${displayName}</h4>
                        <p>${description}</p>
                    </div>
                `;
            }).join('');
            
            populateSubcategories();
        }
        
        // Populate subcategories based on selected category
        function populateSubcategories() {
            const subcategoryGrid = document.getElementById('subcategory-grid');
            let subcategories = ['all'];
            
            if (selectedCategory === 'Appliances') {
                subcategories = ['all', 'Refrigerator', 'Washing Machine', 'Dishwasher', 'Oven', 'Microwave', 'Other'];
            } else if (selectedCategory === 'Lighting') {
                subcategories = ['all', 'LED Bulbs', 'LED Tubes', 'Fixtures'];
            } else if (selectedCategory === 'Heating') {
                subcategories = ['all', 'Boilers', 'Heat Pumps', 'Other'];
            } else if (selectedCategory === 'Renewable') {
                subcategories = ['all', 'Solar Panels', 'Wind Turbines', 'Other'];
            } else if (selectedCategory === 'Smart Home') {
                subcategories = ['all', 'Thermostats', 'Hubs', 'Sensors'];
            } else if (selectedCategory === 'Restaurant Equipment') {
                subcategories = ['all', 'Commercial Ovens', 'Commercial Fridges', 'Commercial Freezers', 'Food Prep'];
            } else if (selectedCategory === 'Office Equipment') {
                subcategories = ['all', 'Computers', 'Laptops', 'Printers', 'Monitors', 'Networking'];
            }
            
            subcategoryGrid.innerHTML = subcategories.map(subcategory => {
                const displayName = subcategory === 'all' ? 'All Subcategories' : subcategory;
                const description = subcategory === 'all' ? `Show all ${selectedCategory === 'all' ? 'products' : selectedCategory.toLowerCase()} products` : 
                    `Energy-efficient ${subcategory.toLowerCase()}`;
                
                return `
                    <div class="category-option" onclick="selectSubcategory('${subcategory}')">
                        <h4>${displayName}</h4>
                        <p>${description}</p>
                    </div>
                `;
            }).join('');
            
            populateProductSelects();
        }
        
        // Select category
        function selectCategory(category) {
            selectedCategory = category;
            selectedSubcategory = 'all';
            
            // Update visual selection
            document.querySelectorAll('#category-grid .category-option').forEach(option => {
                option.classList.remove('selected');
            });
            event.target.closest('.category-option').classList.add('selected');
            
            // Update subcategories
            populateSubcategories();
            updateProductCount();
            updateCurrentSelection();
        }
        
        // Select subcategory
        function selectSubcategory(subcategory) {
            selectedSubcategory = subcategory;
            
            // Update visual selection
            document.querySelectorAll('#subcategory-grid .category-option').forEach(option => {
                option.classList.remove('selected');
            });
            event.target.closest('.category-option').classList.add('selected');
            
            // Update product dropdowns
            populateProductSelects();
            updateProductCount();
            updateCurrentSelection();
        }
        
        // Filter products by category and subcategory
        function filterProductsByCategory() {
            let filtered = allProducts;
            
            if (selectedCategory !== 'all') {
                filtered = filtered.filter(product => product.category === selectedCategory);
            }
            
            if (selectedSubcategory !== 'all') {
                filtered = filtered.filter(product => product.subcategory === selectedSubcategory);
            }
            
            return filtered;
        }
        
        // Populate product dropdowns
        function populateProductSelects() {
            const filteredProducts = filterProductsByCategory();
            const currentSelect = document.getElementById('current-product');
            const efficientSelect = document.getElementById('efficient-product');
            
            // Clear existing options
            currentSelect.innerHTML = '<option value="">Choose a product...</option>';
            efficientSelect.innerHTML = '<option value="">Choose a product...</option>';
            
            // Group products by subcategory
            const groupedProducts = {};
            filteredProducts.forEach(product => {
                const subcategory = product.subcategory || 'Other';
                if (!groupedProducts[subcategory]) {
                    groupedProducts[subcategory] = [];
                }
                groupedProducts[subcategory].push(product);
            });
            
            // Add products grouped by subcategory
            Object.keys(groupedProducts).forEach(subcategory => {
                // Add subcategory header
                currentSelect.add(new Option(`--- ${subcategory} ---`, '', true, true));
                efficientSelect.add(new Option(`--- ${subcategory} ---`, '', true, true));
                
                // Add products in this subcategory
                groupedProducts[subcategory].forEach(product => {
                    let sourceLabel = '';
                    if (product.source === 'ETL') sourceLabel = ' [ETL]';
                    else if (product.source === 'Backend') sourceLabel = ' [Backend]';
                    else if (product.source === 'Energy Star') sourceLabel = ' [Energy Star]';
                    const optionText = `${product.name} (${product.brand})${sourceLabel}`;
                    
                    currentSelect.add(new Option(optionText, product.id));
                    efficientSelect.add(new Option(optionText, product.id));
                });
            });
        }
        
        // Update product count display
        function updateProductCount() {
            const filteredProducts = filterProductsByCategory();
            const totalProducts = allProducts.length;
            const etlCount = allProducts.filter(p => p.source === 'ETL').length;
            const sampleCount = allProducts.filter(p => p.source === 'Sample').length;
            
            document.getElementById('product-count').textContent = 
                `Products Available: ${filteredProducts.length} of ${totalProducts} total products`;
            
            // Update API status
            const apiStatusContent = document.getElementById('api-status-content');
            const energyStarCount = allProducts.filter(p => p.source === 'Energy Star').length;
            const backendCount = allProducts.filter(p => p.source === 'Backend').length;
            apiStatusContent.innerHTML = `
                <p><strong>Backend ETL API:</strong> <span style="color: green;">Connected</span> âœ…</p>
                <p><strong>(${etlCount} ETL + ${backendCount} Backend + ${sampleCount} Sample + ${energyStarCount} Energy Star)</strong></p>
                <p><strong>Product Count:</strong> ${totalProducts} products available</p>
            `;
        }
        
        // Update current selection display
        function updateCurrentSelection() {
            const categoryDisplay = selectedCategory === 'all' ? 'All Categories' : selectedCategory;
            const subcategoryDisplay = selectedSubcategory === 'all' ? 'All Subcategories' : selectedSubcategory;
            
            document.getElementById('current-selection').textContent = 
                `Current Category: ${categoryDisplay} | Subcategory: ${subcategoryDisplay}`;
        }
        
        // Update power badges when products are selected
        function updatePowerBadges() {
            const currentProductId = document.getElementById('current-product').value;
            const efficientProductId = document.getElementById('efficient-product').value;
            
            // Update current product power badge
            if (currentProductId) {
                const currentProduct = allProducts.find(p => p.id === currentProductId);
                if (currentProduct) {
                    document.getElementById('current-power-badge').textContent = `${currentProduct.power}W`;
                }
            } else {
                document.getElementById('current-power-badge').textContent = '0W';
            }
            
            // Update efficient product power badge
            if (efficientProductId) {
                const efficientProduct = allProducts.find(p => p.id === efficientProductId);
                if (efficientProduct) {
                    document.getElementById('efficient-power-badge').textContent = `${efficientProduct.power}W`;
                }
            } else {
                document.getElementById('efficient-power-badge').textContent = '0W';
            }
        }
        
        // Calculate energy savings
        function calculateSavings() {
            const currentProductId = document.getElementById('current-product').value;
            const efficientProductId = document.getElementById('efficient-product').value;
            
            if (!currentProductId || !efficientProductId) {
                showMessage('Please select both products to compare', 'warning');
                return;
            }
            
            const currentProduct = allProducts.find(p => p.id === currentProductId);
            const efficientProduct = allProducts.find(p => p.id === efficientProductId);
            
            if (!currentProduct || !efficientProduct) {
                showMessage('Selected products not found', 'error');
                return;
            }
            
            // Get user input values
            const electricityRate = parseFloat(document.getElementById('electricity-rate').value) || 0.15;
            const currentHours = parseFloat(document.getElementById('hours-use').value) || 8;
            const efficientHours = parseFloat(document.getElementById('efficient-hours-use').value) || 8;
            
            // Calculate running costs using user inputs
            const currentRunningCost = calculateRunningCost(currentProduct.power, electricityRate, currentHours);
            const efficientRunningCost = calculateRunningCost(efficientProduct.power, electricityRate, efficientHours);
            
            const savings = currentRunningCost - efficientRunningCost;
            const dailySavings = savings / 365;
            const monthlySavings = savings / 12;
            
            displayResults(currentProduct, efficientProduct, {
                daily: dailySavings,
                monthly: monthlySavings,
                annual: savings
            }, {
                currentCost: currentRunningCost,
                efficientCost: efficientRunningCost,
                electricityRate: electricityRate,
                currentHours: currentHours,
                efficientHours: efficientHours
            });
        }
        
        // Display results
        function displayResults(currentProduct, efficientProduct, savings, userInputs) {
            const resultsSection = document.getElementById('results-section');
            
            resultsSection.innerHTML = `
                <h2>Energy Savings Analysis</h2>
                <div class="results-grid">
                    <div class="results-panel current-panel">
                        <h3>Current Product Cost</h3>
                        <div class="product-item">
                            <span class="product-name">${currentProduct.name} (${currentProduct.brand})</span>
                            <span class="product-cost">${currentProduct.power}W</span>
                        </div>
                        <div class="product-item">
                            <span class="product-name">Hours per Day</span>
                            <span class="product-cost">${userInputs.currentHours}h</span>
                        </div>
                        ${currentProduct.capacity ? `
                        <div class="product-item">
                            <span class="product-name">Capacity</span>
                            <span class="product-cost">${currentProduct.capacity} kg</span>
                        </div>` : ''}
                        ${currentProduct.placeSettings ? `
                        <div class="product-item">
                            <span class="product-name">Place Settings</span>
                            <span class="product-cost">${currentProduct.placeSettings}</span>
                        </div>` : ''}
                        ${currentProduct.waterPerCycle ? `
                        <div class="product-item">
                            <span class="product-name">Water per Cycle</span>
                            <span class="product-cost">${currentProduct.waterPerCycle} L</span>
                        </div>` : ''}
                        ${currentProduct.waterPerYear ? `
                        <div class="product-item">
                            <span class="product-name">Water per Year</span>
                            <span class="product-cost">${currentProduct.waterPerYear} L</span>
                        </div>` : ''}
                        <div class="product-item">
                            <span class="product-name">[${currentProduct.source}]</span>
                        </div>
                        <div class="product-item">
                            <strong>Annual Cost (â‚¬${userInputs.electricityRate}/kWh)</strong>
                            <strong class="product-cost">â‚¬${userInputs.currentCost.toFixed(2)}</strong>
                        </div>
                    </div>
                    
                    <div class="results-panel efficient-panel">
                        <h3>Energy-Efficient Product Cost</h3>
                        <div class="product-item">
                            <span class="product-name">${efficientProduct.name} (${efficientProduct.brand})</span>
                            <span class="product-cost">${efficientProduct.power}W</span>
                        </div>
                        <div class="product-item">
                            <span class="product-name">Hours per Day</span>
                            <span class="product-cost">${userInputs.efficientHours}h</span>
                        </div>
                        ${efficientProduct.capacity ? `
                        <div class="product-item">
                            <span class="product-name">Capacity</span>
                            <span class="product-cost">${efficientProduct.capacity} kg</span>
                        </div>` : ''}
                        ${efficientProduct.placeSettings ? `
                        <div class="product-item">
                            <span class="product-name">Place Settings</span>
                            <span class="product-cost">${efficientProduct.placeSettings}</span>
                        </div>` : ''}
                        ${efficientProduct.waterPerCycle ? `
                        <div class="product-item">
                            <span class="product-name">Water per Cycle</span>
                            <span class="product-cost">${efficientProduct.waterPerCycle} L</span>
                        </div>` : ''}
                        ${efficientProduct.waterPerYear ? `
                        <div class="product-item">
                            <span class="product-name">Water per Year</span>
                            <span class="product-cost">${efficientProduct.waterPerYear} L</span>
                        </div>` : ''}
                        <div class="product-item">
                            <span class="product-name">[${efficientProduct.source}]</span>
                        </div>
                        <div class="product-item">
                            <strong>Annual Cost (â‚¬${userInputs.electricityRate}/kWh)</strong>
                            <strong class="product-cost">â‚¬${userInputs.efficientCost.toFixed(2)}</strong>
                        </div>
                    </div>
                    
                    <div class="results-panel savings-panel">
                        <h3>Your Savings</h3>
                        <div class="product-item">
                            <span class="product-name">Daily Savings</span>
                            <span class="product-cost">â‚¬${savings.daily.toFixed(2)}</span>
                        </div>
                        <div class="product-item">
                            <span class="product-name">Monthly Savings</span>
                            <span class="product-cost">â‚¬${savings.monthly.toFixed(2)}</span>
                        </div>
                        <div class="product-item">
                            <span class="product-name">Annual Savings</span>
                            <span class="product-cost">â‚¬${savings.annual.toFixed(2)}</span>
                        </div>
                    </div>
                </div>
                
                <div class="savings-banner">
                    You could save â‚¬${savings.annual.toFixed(2)} per year by switching to energy-efficient products!
                </div>
            `;
            
            resultsSection.style.display = 'block';
            resultsSection.scrollIntoView({ behavior: 'smooth' });
        }
        
        // Show message
        function showMessage(message, type = 'info') {
            console.log(`[${type.toUpperCase()}] ${message}`);
            // You can add a toast notification here if desired
        }
    </script>
</body>
</html>
  