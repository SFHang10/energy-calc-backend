<!DOCTYPE html>
<html>
<head>
    <title>Test Expanded Database - Water Usage Included</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; background: #f5f5f5; }
        .success { color: green; font-weight: bold; }
        .error { color: red; font-weight: bold; }
        .info { color: blue; }
        .product { border: 1px solid #ccc; margin: 10px; padding: 15px; background: white; border-radius: 8px; }
        .water-info { background: #e3f2fd; padding: 8px; margin-top: 8px; border-radius: 4px; border-left: 4px solid #2196f3; }
        .water-usage { color: #1976d2; font-weight: bold; }
        .no-water { color: #666; font-style: italic; }
        .header { background: #2196f3; color: white; padding: 20px; border-radius: 8px; margin-bottom: 20px; }
        .stats { background: #4caf50; color: white; padding: 15px; border-radius: 8px; margin: 20px 0; }
        .category-stats { background: #ff9800; color: white; padding: 10px; border-radius: 6px; margin: 10px 0; }
    </style>
</head>
<body>
    <div class="header">
        <h1>üåä Test Expanded Database - Water Usage Included</h1>
        <p>Testing the expanded database with 139+ products including water consumption data</p>
    </div>
    
    <div id="status"></div>
    <div id="summary"></div>
    <div id="products"></div>

    <!-- Load the permanent database first -->
    <script src="product-database-backup.js"></script>
    
    <!-- Load expansion batches -->
    <script src="add-washing-machines.js"></script>
    <script src="add-dishwashers.js"></script>
    <script src="add-refrigerators.js"></script>
    <script src="add-lighting-products.js"></script>
    <script src="add-heating-products.js"></script>
    
    <!-- Load the expansion script -->
    <script src="expand-database-safely.js"></script>
    
    <script>
        // Test the expanded database
        function testExpandedDatabase() {
            const statusDiv = document.getElementById('status');
            const summaryDiv = document.getElementById('summary');
            const productsDiv = document.getElementById('products');
            
            try {
                // Check original database
                if (typeof PRODUCT_DATABASE_BACKUP === 'undefined') {
                    statusDiv.innerHTML = '<p class="error">‚ùå Database not loaded</p>';
                    return;
                }
                
                const originalCount = PRODUCT_DATABASE_BACKUP.getProductCount();
                statusDiv.innerHTML = '<p class="success">‚úÖ Database loaded successfully!</p>';
                statusDiv.innerHTML += `<p class="info">üìä Original products: ${originalCount}</p>`;
                
                // Expand the database
                console.log('üîÑ Expanding database...');
                const success = expandDatabase();
                
                if (success) {
                    const newCount = PRODUCT_DATABASE_BACKUP.getProductCount();
                    const added = newCount - originalCount;
                    
                    summaryDiv.innerHTML = `
                        <div class="stats">
                            <h2>üéâ Expansion Results:</h2>
                            <p class="success">‚úÖ Expansion successful!</p>
                            <p class="info">üìä Products added: ${added}</p>
                            <p class="info">üìä Total products now: ${newCount}</p>
                            <p class="info">üíß Water usage data included for sustainability!</p>
                        </div>
                    `;
                    
                    // Show some new products with water usage
                    const products = PRODUCT_DATABASE_BACKUP.getAllProducts();
                    const newProducts = products.slice(originalCount, originalCount + 20);
                    
                    productsDiv.innerHTML = '<h2>üåä New Products Added (with Water Usage):</h2>';
                    newProducts.forEach(product => {
                        const waterInfo = product.waterUsage > 0 ? 
                            `<div class="water-info">
                                <span class="water-usage">üíß Water usage: ${product.waterUsage}L per use</span>
                                <br><small>This product uses water during operation</small>
                            </div>` : 
                            '<div class="water-info">
                                <span class="no-water">üíß No water usage</span>
                                <br><small>This product operates without water consumption</small>
                            </div>';
                        
                        productsDiv.innerHTML += `
                            <div class="product">
                                <strong>${product.name}</strong><br>
                                <strong>Category:</strong> ${product.category} | <strong>Subcategory:</strong> ${product.subcategory}<br>
                                <strong>Power:</strong> ${product.power}W | <strong>Brand:</strong> ${product.brand}<br>
                                <strong>Energy Rating:</strong> ${product.energyRating} | <strong>Efficiency:</strong> ${product.efficiency}
                                ${waterInfo}
                            </div>
                        `;
                    });
                    
                    // Show water usage summary
                    const waterProducts = products.filter(p => p.waterUsage > 0);
                    const noWaterProducts = products.filter(p => p.waterUsage === 0);
                    
                    productsDiv.innerHTML += `
                        <div class="stats">
                            <h3>üíß Water Usage Summary:</h3>
                            <p><strong>Products with water usage:</strong> ${waterProducts.length}</p>
                            <p><strong>Products without water usage:</strong> ${noWaterProducts.length}</p>
                            <p><strong>Total products:</strong> ${products.length}</p>
                        </div>
                    `;
                    
                    // Show category breakdown
                    const categories = {};
                    products.forEach(product => {
                        if (!categories[product.category]) {
                            categories[product.category] = 0;
                        }
                        categories[product.category]++;
                    });
                    
                    let categoryBreakdown = '<div class="category-stats"><h3>üìä Category Breakdown:</h3>';
                    Object.entries(categories).forEach(([category, count]) => {
                        categoryBreakdown += `<p><strong>${category}:</strong> ${count} products</p>`;
                    });
                    categoryBreakdown += '</div>';
                    
                    productsDiv.innerHTML += categoryBreakdown;
                    
                } else {
                    summaryDiv.innerHTML = '<p class="error">‚ùå Expansion failed</p>';
                }
                
            } catch (error) {
                statusDiv.innerHTML = `<p class="error">‚ùå Error: ${error.message}</p>`;
                console.error('Test error:', error);
            }
        }
        
        window.addEventListener('load', testExpandedDatabase);
    </script>
</body>
</html>
